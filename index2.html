<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Family Habit Tracker</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
    .container{max-width:1200px;margin:0 auto}
    .header{text-align:center;color:#fff;margin-bottom:30px}
    .header h1{font-size:2.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,.2)}
    .user-info{background:rgba(255,255,255,.2);padding:10px 20px;border-radius:20px;
      display:inline-block;margin-bottom:15px;backdrop-filter:blur(10px)}
    .mode-switch{padding:8px 16px;background:rgba(255,255,255,.3);border:none;border-radius:10px;
      color:#fff;cursor:pointer;margin-left:5px}
    .mode-switch.active{background:rgba(255,255,255,.6)}
    .week-navigation{display:flex;justify-content:center;align-items:center;gap:20px;margin-bottom:20px;color:#fff}
    .nav-btn{padding:6px 14px;border:none;border-radius:6px;cursor:pointer}
    .stats{display:flex;justify-content:center;gap:20px;color:#fff}
    .main-card{background:#fff;border-radius:20px;padding:30px;margin-top:20px}
    .input-section{display:flex;gap:10px;margin-bottom:20px}
    .input-section.parent-mode{opacity:.5;pointer-events:none}
    .task-input{flex:1;padding:10px;border:1px solid #ccc;border-radius:8px}
    .add-btn{padding:10px 20px;background:#667eea;color:#fff;border:none;border-radius:8px;cursor:pointer}
    .habits-grid{margin-top:10px}
    .habit-item{background:#f8f9fa;border-radius:12px;padding:15px;margin-bottom:15px}
    .habit-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
    .delete-habit-btn{background:#ff6b6b;color:#fff;border:none;padding:6px 10px;border-radius:6px;cursor:pointer}
    .delete-habit-btn.parent-mode{opacity:.5;pointer-events:none}
    .days-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
    .day-box{background:#fff;border:1px solid #ccc;border-radius:6px;padding:8px;text-align:center;cursor:pointer;font-size:12px}
    .day-box.completed{background:#667eea;color:#fff}
    .day-box.parent-mode{cursor:default}
    .clear-all-btn{margin-top:15px;padding:10px 20px;background:#ff6b6b;color:#fff;border:none;
      border-radius:8px;cursor:pointer;display:block;margin-left:auto;margin-right:auto}
    .clear-all-btn.parent-mode{opacity:.5;pointer-events:none}
    .empty-state{text-align:center;padding:40px;color:#777}
    @keyframes shake{0%,100%{transform:translateX(0)}20%,60%{transform:translateX(-6px)}40%,80%{transform:translateX(6px)}}
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üë®‚Äçüë©‚Äçüëß Family Habit Tracker</h1>
      <div class="user-info">
        Mode:
        <button class="mode-switch active" id="kidMode" onclick="setMode('kid')">üëß Kid</button>
        <button class="mode-switch" id="parentMode" onclick="setMode('parent')">üë®‚Äçüë©‚Äçüëß Parent</button>
      </div>
      <div class="week-navigation">
        <button class="nav-btn" onclick="changeWeek(-1)" id="prevWeekBtn">‚Üê Previous</button>
        <div class="week-info" id="weekInfo"></div>
        <button class="nav-btn" onclick="changeWeek(1)" id="nextWeekBtn">Next ‚Üí</button>
      </div>
      <div class="stats">
        <div><span id="totalHabits">0</span> Habits</div>
        <div><span id="weeklyCompletions">0</span> Completions</div>
        <div><span id="overallRate">0</span>% Success</div>
      </div>
    </div>

    <div class="main-card">
      <div class="input-section" id="inputSection">
        <input type="text" class="task-input" id="habitInput" placeholder="Add a new habit...">
        <button class="add-btn" onclick="addHabit()">Add</button>
      </div>
      <div class="habits-grid" id="habitsGrid"></div>
      <button class="clear-all-btn" onclick="clearAllHabits()" style="display:none" id="clearBtn">Clear All</button>
    </div>
  </div>

  <script>
    let habits = [];
    let currentWeekOffset = 0;
    let currentWeekDates = [];
    let currentMode = 'kid';

    document.addEventListener('DOMContentLoaded', () => {
      loadHabitsLocal();
      updateWeekInfo();
      renderHabits();
      document.getElementById('habitInput').addEventListener('keypress', e=>{
        if (e.key==='Enter' && currentMode==='kid') addHabit();
      });
    });

    function setMode(mode){
      currentMode = mode;
      document.getElementById('kidMode').classList.toggle('active', mode==='kid');
      document.getElementById('parentMode').classList.toggle('active', mode==='parent');
      document.getElementById('inputSection').classList.toggle('parent-mode', mode==='parent');
      document.getElementById('clearBtn').classList.toggle('parent-mode', mode==='parent');
      renderHabits();
    }

    function getWeekDates(offset=0){
      const now=new Date(); now.setDate(now.getDate()+offset*7);
      const start=new Date(now); start.setDate(now.getDate()-now.getDay());
      return Array.from({length:7},(_,i)=>{let d=new Date(start);d.setDate(start.getDate()+i);return d;});
    }
    function updateWeekInfo(){
      currentWeekDates=getWeekDates(currentWeekOffset);
      const s=currentWeekDates[0], e=currentWeekDates[6];
      const m=['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
      document.getElementById('weekInfo').textContent=`${m[s.getMonth()]} ${s.getDate()} - ${m[e.getMonth()]} ${e.getDate()}, ${e.getFullYear()}`;
      document.getElementById('nextWeekBtn').disabled=currentWeekOffset>=0;
    }
    function changeWeek(d){currentWeekOffset+=d;updateWeekInfo();renderHabits();}
    function getDateKey(d){return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;}

    function addHabit(){
      if(currentMode==='parent') return;
      const input=document.getElementById('habitInput');
      const text=input.value.trim();
      if(!text){input.style.animation='shake .4s';setTimeout(()=>input.style.animation='',400);return;}
      const habit={id:Date.now(),name:text,completions:{},createdAt:new Date().toISOString()};
      habits.unshift(habit);
      saveHabitsLocal();renderHabits();input.value='';input.focus();
    }
    function toggleDay(id,key){
      if(currentMode==='parent') return;
      const h=habits.find(h=>h.id==id); if(!h) return;
      h.completions[key] ? delete h.completions[key] : h.completions[key]=true;
      saveHabitsLocal();renderHabits();
    }
    function deleteHabit(id){
      if(currentMode==='parent') return;
      if(!confirm('Delete this habit?')) return;
      habits=habits.filter(h=>h.id!=id);
      saveHabitsLocal();renderHabits();
    }
    function clearAllHabits(){
      if(currentMode==='parent') return;
      if(!confirm('Clear ALL habits?')) return;
      habits=[];saveHabitsLocal();renderHabits();
    }

    function saveHabitsLocal(){localStorage.setItem('family_habits',JSON.stringify(habits));}
    function loadHabitsLocal(){habits=JSON.parse(localStorage.getItem('family_habits')||'[]');}

    function renderHabits(){
      const grid=document.getElementById('habitsGrid'); grid.innerHTML='';
      if(!habits.length){grid.innerHTML=`<div class="empty-state">üìã No habits yet. Add one above!</div>`;
        document.getElementById('clearBtn').style.display='none';updateStats();return;}
      document.getElementById('clearBtn').style.display='block';
      const dayNames=['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
      habits.forEach(h=>{
        const card=document.createElement('div'); card.className='habit-item';
        card.innerHTML=`<div class="habit-header">
          <div class="habit-name">üåü ${h.name}</div>
          <button class="delete-habit-btn${currentMode==='parent'?' parent-mode':''}">Delete</button></div>`;
        const days=document.createElement('div'); days.className='days-grid';
        currentWeekDates.forEach(d=>{
          const key=getDateKey(d);
          const box=document.createElement('div');
          box.className='day-box'+(h.completions[key]?' completed':'')+(currentMode==='parent'?' parent-mode':'');
          box.innerHTML=`<div>${dayNames[d.getDay()]}</div><div>${d.getMonth()+1}/${d.getDate()}</div>`;
          box.onclick=()=>toggleDay(h.id,key);
          days.appendChild(box);
        });
        card.appendChild(days);
        card.querySelector('.delete-habit-btn').onclick=()=>deleteHabit(h.id);
        grid.appendChild(card);
      });
      updateStats();
    }

    function updateStats(){
      document.getElementById('totalHabits').textContent=habits.length;
      document.getElementById('weeklyCompletions').textContent=getWeeklyCompletions();
      document.getElementById('overallRate').textContent=getOverallRate();
    }
    function getWeeklyCompletions(){
      const weekKeys=currentWeekDates.map(getDateKey);
      return habits.reduce((t,h)=>t+weekKeys.filter(k=>h.completions&&h.completions[k]).length,0);
    }
    function getOverallRate(){
      let done=0,possible=0;
      habits.forEach(h=>{
        done+=Object.keys(h.completions||{}).length;
        if(h.createdAt){
          const s=new Date(h.createdAt), today=new Date();today.setHours(0,0,0,0);
          possible+=Math.max(1,Math.floor((today-s)/(1000*60*60*24))+1);
        }
      });
      return possible?Math.round(done/possible*100):0;
    }
  </script>
</body>
</html>
